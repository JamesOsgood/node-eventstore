<!DOCTYPE HTML>

<html>

<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>node-eventstore: eventsourcing for node.js</title>
        <link rel='stylesheet' href='public/css/main.css' type='text/css' media='all' />
        <link rel="stylesheet" href="public/css/prettify.css" type="text/css" />
        <link rel="stylesheet" href="public/css/flexible-nav.min.css" type="text/css" />
        <script type="text/javascript" src="public/js/jquery-1.6.4.min.js"></script>
        <script type="text/javascript" src="public/js/prettify.js"></script>
        <script type="text/javascript" src="public/js/flexible-nav.min.js"></script>
</head>

<body>

<div id="forkme">
    <a href="https://github.com/adrai/node-eventstore"><img src="public/img/gihub_ribbon.png"></a>
</div>

<header>
    <a href="">
        <h1 id="title" style="display: none;">node-eventstore</h1><br />
        <h2 id="subtitle" style="display: none;">eventsourcing for node.js</h2>
    </a>
</header>

<section id='content'>

<h1>‚ö†Ô∏è IMPORTANT NEWS! üì∞</h1>

<p>I‚Äôve been dealing with CQRS, event-sourcing and DDD long enough now that I don‚Äôt need working with it anymore unfortunately, so at least for now this my formal farewell!</p>

<p>I want to thank everyone who has contributed in one way or another.
Especially...</p>

<ul>
<li><a href="https://github.com/jamuhl">Jan</a>, who introduced me to this topic.</li>
<li><a href="https://github.com/nanov">Dimitar</a>, one of the last bigger contributors and maintainer.</li>
<li>My last employer, who gave me the possibility to use all these CQRS modules in a big Cloud-System.</li>
<li>My family and friends, who very often came up short.</li>
</ul>

<p>Finally, I would like to thank <a href="https://github.com/goloroden">Golo Roden</a>, who was there very early at the beginning of my CQRS/ES/DDD journey and is now here again to take over these modules.</p>

<p>Golo Roden is the founder, CTO and managing director of <a href="https://www.thenativeweb.io/">the native web</a>, a company specializing in native web technologies. Among other things, he also teaches CQRS/ES/DDD etc. and based on his vast knowledge, he brought wolkenkit to life.
<a href="https://wolkenkit.io">wolkenkit</a> is a CQRS and event-sourcing framework based on Node.js. It empowers you to build and run scalable distributed web and cloud services that process and store streams of domain events.</p>

<p>With this step, I can focus more on <a href="https://www.i18next.com">i18next</a>, <a href="https://locize.com">locize</a> and <a href="https://localistars.com">localistars</a>. I'm happy about that. üòä</p>

<p>So, there is no end, but the start of a new phase for my CQRS modules. üòâ</p>

<p>I wish you all good luck on your journey.</p>

<p>Who knows, maybe we'll meet again in a github issue or PR at <a href="https://github.com/i18next/i18next">i18next</a> üòâ</p>

<p><a href="https://twitter.com/adrirai">Adriano Raiano</a></p>

<hr />

<h1>Introduction</h1>

<p><a href="http://js.org"><img src="https://img.shields.io/badge/js.org-eventstore-ffb400.svg?style=flat-square" alt="JS.ORG" title="" /></a>
<a href="https://travis-ci.org/adrai/node-eventstore"><img src="https://img.shields.io/travis/adrai/node-eventstore.svg" alt="travis" title="" /></a> <a href="https://npmjs.org/package/eventstore"><img src="https://img.shields.io/npm/v/eventstore.svg" alt="npm" title="" /></a></p>

<p>The project goal is to provide an eventstore implementation for node.js:</p>

<ul>
<li>load and store events via EventStream object</li>
<li>event dispatching to your publisher (optional)</li>
<li>supported Dbs (inmemory, mongodb, redis, tingodb, elasticsearch, azuretable, dynamodb)</li>
<li>snapshot support</li>
<li>query your events</li>
</ul>

<h1>Consumers</h1>

<ul>
<li><a href="https://github.com/adrai/node-cqrs-domain">cqrs-domain</a></li>
<li><a href="https://github.com/leogiese/cqrs">cqrs</a></li>
</ul>

<h1>Installation</h1>

<pre><code><span class="pln">npm install eventstore<br /></span></code></pre>

<h1>Usage</h1>

<h2>Require the module and init the eventstore:</h2>

<pre><code><span class="kwd">var</span><span class="pln"> eventstore </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> eventstore</span><span class="pun">();</span><span class="pln"><br /></span></code></pre>

<p>By default the eventstore will use an inmemory Storage.</p>

<h3>Logging</h3>

<p>For logging and debugging you can use <a href="https://github.com/visionmedia/debug">debug</a> by <a href="https://github.com/visionmedia">TJ Holowaychuk</a></p>

<p>simply run your process with</p>

<pre><code><span class="pln">DEBUG</span><span class="pun">=</span><span class="pln">eventstore</span><span class="pun">*</span><span class="pln"> node app</span><span class="pun">.</span><span class="pln">js<br /></span></code></pre>

<h2>Provide implementation for storage</h2>

<p>example with mongodb:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'mongodb'</span><span class="pun">,</span><span class="pln"><br />&nbsp; host</span><span class="pun">:</span><span class="pln"> </span><span class="str">'localhost'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">27017</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; dbName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'eventstore'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; eventsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; snapshotsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; transactionsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'transactions'</span><span class="pun">,</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; timeout</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// maxSnapshotsCount: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional, defaultly will keep all snapshots</span><span class="pln"><br />&nbsp; </span><span class="com">// authSource: 'authedicationDatabase', &nbsp; &nbsp; &nbsp; &nbsp;// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// username: 'technicalDbUser', &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// password: 'secret' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// url: 'mongodb://user:pass@host:port/db?opts // optional</span><span class="pln"><br />&nbsp; </span><span class="com">// positionsCollectionName: 'positions' // optioanl, defaultly wont keep position</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with redis:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'redis'</span><span class="pun">,</span><span class="pln"><br />&nbsp; host</span><span class="pun">:</span><span class="pln"> </span><span class="str">'localhost'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">6379</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; db</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; prefix</span><span class="pun">:</span><span class="pln"> </span><span class="str">'eventstore'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; eventsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; snapshotsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; timeout</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// maxSnapshotsCount: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional, defaultly will keep all snapshots</span><span class="pln"><br />&nbsp; </span><span class="com">// password: 'secret' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with tingodb:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'tingodb'</span><span class="pun">,</span><span class="pln"><br />&nbsp; dbPath</span><span class="pun">:</span><span class="pln"> </span><span class="str">'/path/to/my/db/file'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; eventsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; snapshotsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; transactionsCollectionName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'transactions'</span><span class="pun">,</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; timeout</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// maxSnapshotsCount: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional, defaultly will keep all snapshots</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with elasticsearch:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'elasticsearch'</span><span class="pun">,</span><span class="pln"><br />&nbsp; host</span><span class="pun">:</span><span class="pln"> </span><span class="str">'localhost:9200'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; indexName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'eventstore'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; eventsTypeName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; snapshotsTypeName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; log</span><span class="pun">:</span><span class="pln"> </span><span class="str">'warning'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; maxSearchResults</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// maxSnapshotsCount: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// optional, defaultly will keep all snapshots</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with custom elasticsearch client (e.g. with AWS ElasticSearch client. Note <code>http-aws-es</code> package usage in this example):</p>

<pre><code><span class="kwd">var</span><span class="pln"> elasticsearch </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'elasticsearch'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> esClient </span><span class="pun">=</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> elasticsearch</span><span class="pun">.</span><span class="typ">Client</span><span class="pun">({</span><span class="pln"><br />&nbsp; hosts</span><span class="pun">:</span><span class="pln"> </span><span class="str">'SOMETHING.es.amazonaws.com'</span><span class="pun">,</span><span class="pln"><br />&nbsp; connectionClass</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'http-aws-es'</span><span class="pun">),</span><span class="pln"><br />&nbsp; amazonES</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; region</span><span class="pun">:</span><span class="pln"> </span><span class="str">'us-east-1'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; accessKey</span><span class="pun">:</span><span class="pln"> </span><span class="str">'REPLACE_AWS_accessKey'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; secretKey</span><span class="pun">:</span><span class="pln"> </span><span class="str">'REPLACE_AWS_secretKey'</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'elasticsearch'</span><span class="pun">,</span><span class="pln"><br />&nbsp; client</span><span class="pun">:</span><span class="pln"> esClient</span><span class="pun">,</span><span class="pln"><br />&nbsp; indexName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'eventstore'</span><span class="pun">,</span><span class="pln"><br />&nbsp; eventsTypeName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"><br />&nbsp; snapshotsTypeName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"><br />&nbsp; log</span><span class="pun">:</span><span class="pln"> </span><span class="str">'warning'</span><span class="pun">,</span><span class="pln"><br />&nbsp; maxSearchResults</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with azuretable:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'azuretable'</span><span class="pun">,</span><span class="pln"><br />&nbsp; storageAccount</span><span class="pun">:</span><span class="pln"> </span><span class="str">'nodeeventstore'</span><span class="pun">,</span><span class="pln"><br />&nbsp; storageAccessKey</span><span class="pun">:</span><span class="pln"> </span><span class="str">'aXJaod96t980AbNwG9Vh6T3ewPQnvMWAn289Wft9RTv+heXQBxLsY3Z4w66CI7NN12+1HUnHM8S3sUbcI5zctg=='</span><span class="pun">,</span><span class="pln"><br />&nbsp; storageTableHost</span><span class="pun">:</span><span class="pln"> </span><span class="str">'https://nodeeventstore.table.core.windows.net/'</span><span class="pun">,</span><span class="pln"><br />&nbsp; eventsTableName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; snapshotsTableName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; timeout</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>example with dynamodb:</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; &nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'dynamodb'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; eventsTableName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'events'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; snapshotsTableName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'snapshots'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; undispatchedEventsTableName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'undispatched'</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">EventsReadCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">EventsWriteCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">SnapshotReadCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">SnapshotWriteCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">UndispatchedEventsReadCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">UndispatchedEventsReadCapacityUnits</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; useUndispatchedEventsTable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; eventsTableStreamEnabled</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; eventsTableStreamViewType</span><span class="pun">:</span><span class="pln"> </span><span class="str">'NEW_IMAGE'</span><span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>DynamoDB credentials are obtained by eventstore either from environment vars or credentials file. For setup see <a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/guide/node-configuring.html">AWS Javascript SDK</a>.</p>

<p>DynamoDB provider supports <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html">DynamoDB local</a> for local development via the AWS SDK <code>endpoint</code> option. Just set the <code>$AWS_DYNAMODB_ENDPOINT</code> (or <code>%AWS_DYNAMODB_ENDPOINT%</code> in Windows) environment variable to point to your running instance of Dynamodb local like this:</p>

<pre><code><span class="pln">$ </span><span class="kwd">export</span><span class="pln"> AWS_DYNAMODB_ENDPOINT</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//localhost:8000</span><span class="pln"><br /></span></code></pre>

<p>Or on Windows:</p>

<pre><code><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> AWS_DYNAMODB_ENDPOINT</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//localhost:8000</span><span class="pln"><br /></span></code></pre>

<p>The <strong>useUndispatchedEventsTable</strong> option to available for those who prefer to use DyanmoDB.Streams to pull events from the store instead of the UndispatchedEvents table. The default is true. Setting this option to false will result in the UndispatchedEvents table not being created at all, the getUndispatchedEvents method will always return an empty array, and the setEventToDispatched will effectively do nothing.</p>

<p>Refer to <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_StreamSpecification.html#DDB-Type-StreamSpecification-StreamViewType">StreamViewType</a> for a description of the <strong>eventsTableStreamViewType</strong> option</p>

<h2>Built-in event publisher (optional)</h2>

<p>if defined the eventstore will try to publish AND set event do dispatched on its own...</p>

<h3>sync interface</h3>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">useEventPublisher</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">evt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// bus.emit('event', evt);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h3>async interface</h3>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">useEventPublisher</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">evt</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// bus.sendAndWaitForAck('event', evt, callback);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>catch connect and disconnect events</h2>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'storage connected'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'disconnect'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'connection to storage is gone'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>define event mappings [optional]</h2>

<p>Define which values should be mapped/copied to the payload event.</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">defineEventMappings</span><span class="pun">({</span><span class="pln"><br />&nbsp; id</span><span class="pun">:</span><span class="pln"> </span><span class="str">'id'</span><span class="pun">,</span><span class="pln"><br />&nbsp; commitId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'commitId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; commitSequence</span><span class="pun">:</span><span class="pln"> </span><span class="str">'commitSequence'</span><span class="pun">,</span><span class="pln"><br />&nbsp; commitStamp</span><span class="pun">:</span><span class="pln"> </span><span class="str">'commitStamp'</span><span class="pun">,</span><span class="pln"><br />&nbsp; streamRevision</span><span class="pun">:</span><span class="pln"> </span><span class="str">'streamRevision'</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>initialize</h2>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">init</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// this callback is called when all is ready...</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">init</span><span class="pun">();</span><span class="pln"> </span><span class="com">// callback is optional</span><span class="pln"><br /></span></code></pre>

<h2>working with the eventstore</h2>

<h3>get the eventhistory (of an aggregate)</h3>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getEventStream</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the original event will be in events[i].payload</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>or</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getEventStream</span><span class="pun">({</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'myAggregateId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the original event will be in events[i].payload</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>'streamId' and 'aggregateId' are the same...
In ddd terms aggregate and context are just to be more precise in language.
For example you can have a 'person' aggregate in the context 'human ressources' and a 'person' aggregate in the context of 'business contracts'...
So you can have 2 complete different aggregate instances of 2 complete different aggregates (but perhaps with same name) in 2 complete different contexts</p>

<p>you can request an eventstream even by limit the query with a 'minimum revision number' and a 'maximum revision number'</p>

<pre><code><span class="kwd">var</span><span class="pln"> revMin </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; revMax </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit revMax or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventStream</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">{</span><span class="com">/* query */</span><span class="pun">},</span><span class="pln"> revMin</span><span class="pun">,</span><span class="pln"> revMax</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the original event will be in events[i].payload</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>store a new event and commit it to store</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getEventStream</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; stream</span><span class="pun">.</span><span class="pln">addEvent</span><span class="pun">({</span><span class="pln"> </span><span class="kwd">my</span><span class="pun">:</span><span class="pln"> </span><span class="str">'event'</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br />&nbsp; stream</span><span class="pun">.</span><span class="pln">addEvents</span><span class="pun">([{</span><span class="pln"> </span><span class="kwd">my</span><span class="pun">:</span><span class="pln"> </span><span class="str">'event2'</span><span class="pln"> </span><span class="pun">}]);</span><span class="pln"><br /><br />&nbsp; stream</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// or</span><span class="pln"><br /><br />&nbsp; stream</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">stream</span><span class="pun">.</span><span class="pln">eventsToDispatch</span><span class="pun">);</span><span class="pln"> </span><span class="com">// this is an array containing all added events in this commit.</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>if you defined an event publisher function the committed event will be dispatched to the provided publisher</p>

<p>if you just want to load the last event as stream you can call getLastEventAsStream instead of ¬¥getEventStream¬¥.</p>

<h2>working with snapshotting</h2>

<p>get snapshot and eventhistory from the snapshot point</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getFromSnapshot</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> snapshot</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> snap </span><span class="pun">=</span><span class="pln"> snapshot</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// events history from given snapshot</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadSnapshot(snap);</span><span class="pln"><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>or</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getFromSnapshot</span><span class="pun">({</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'myAggregateId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> snapshot</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> snap </span><span class="pun">=</span><span class="pln"> snapshot</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// events history from given snapshot</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadSnapshot(snap);</span><span class="pln"><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>you can request a snapshot and an eventstream even by limit the query with a 'maximum revision number'</p>

<pre><code><span class="kwd">var</span><span class="pln"> revMax </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit revMax or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getFromSnapshot</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">{</span><span class="com">/* query */</span><span class="pun">},</span><span class="pln"> revMax</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> snap </span><span class="pun">=</span><span class="pln"> snapshot</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// events history from given snapshot</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadSnapshot(snap);</span><span class="pln"><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>create a snapshot point</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getFromSnapshot</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> snapshot</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> snap </span><span class="pun">=</span><span class="pln"> snapshot</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> history </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">events</span><span class="pun">;</span><span class="pln"> </span><span class="com">// events history from given snapshot</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// myAggregate.loadSnapshot(snap);</span><span class="pln"><br />&nbsp; </span><span class="com">// myAggregate.loadFromHistory(history);</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// create a new snapshot depending on your rules</span><span class="pln"><br />&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">history</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> myLimit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; es</span><span class="pun">.</span><span class="pln">createSnapshot</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; streamId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; data</span><span class="pun">:</span><span class="pln"> myAggregate</span><span class="pun">.</span><span class="pln">getSnap</span><span class="pun">(),</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; revision</span><span class="pun">:</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">lastRevision</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; version</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="com">// snapshot saved</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="com">// or</span><span class="pln"><br /><br />&nbsp; &nbsp; es</span><span class="pun">.</span><span class="pln">createSnapshot</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'myAggregateId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; data</span><span class="pun">:</span><span class="pln"> myAggregate</span><span class="pun">.</span><span class="pln">getSnap</span><span class="pun">(),</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; revision</span><span class="pun">:</span><span class="pln"> stream</span><span class="pun">.</span><span class="pln">lastRevision</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; version</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="com">// snapshot saved</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// go on: store new event and commit it</span><span class="pln"><br />&nbsp; </span><span class="com">// stream.addEvents...</span><span class="pln"><br /><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>You can automatically clean older snapshots by configuring the number of snapshots to keep with <code>maxSnapshotsCount</code> in <code>eventstore</code> options.</p>

<h2>own event dispatching (no event publisher function defined)</h2>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getUndispatchedEvents</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span><span class="com">// or es.getUndispatchedEvents('streamId', function(err, evts) {</span><span class="pln"><br /></span><span class="com">// or es.getUndispatchedEvents({ // free choice (all, only context, only aggregate, only aggregateId...)</span><span class="pln"><br /></span><span class="com">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;context: 'hr',</span><span class="pln"><br /></span><span class="com">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;aggregate: 'person',</span><span class="pln"><br /></span><span class="com">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;aggregateId: 'uuid'</span><span class="pln"><br /></span><span class="com">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, function(err, evts) {</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// all undispatched events</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">evts</span><span class="pun">);</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// dispatch it and set the event as dispatched</span><span class="pln"><br /><br />&nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> e </span><span class="kwd">in</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> evt </span><span class="pun">=</span><span class="pln"> evts</span><span class="pun">[</span><span class="pln">r</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; es</span><span class="pun">.</span><span class="pln">setEventToDispatched</span><span class="pun">(</span><span class="pln">evt</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// or</span><span class="pln"><br />&nbsp; &nbsp; es</span><span class="pun">.</span><span class="pln">setEventToDispatched</span><span class="pun">(</span><span class="pln">evt</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{});</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>query your events</h2>

<p>for replaying your events or for rebuilding a viewmodel or just for fun...</p>

<p>skip, limit always optional</p>

<pre><code><span class="kwd">var</span><span class="pln"> skip </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; limit </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit limit or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">(</span><span class="pln">skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">({</span><span class="pln"> </span><span class="com">// free choice (all, only context, only aggregate, only aggregateId...)</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'uuid'</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<p>by revision</p>

<p>revMin, revMax always optional</p>

<pre><code><span class="kwd">var</span><span class="pln"> revMin </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; revMax </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit revMax or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventsByRevision</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> revMin</span><span class="pun">,</span><span class="pln"> revMax</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventsByRevision</span><span class="pun">({</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'myAggregateId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// optional</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"> revMin</span><span class="pun">,</span><span class="pln"> revMax</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{});</span><span class="pln"><br /></span></code></pre>

<p>by commitStamp</p>

<p>skip, limit always optional</p>

<pre><code><span class="kwd">var</span><span class="pln"> skip </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; limit </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit limit or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventsSince</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="lit">2015</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">),</span><span class="pln"> skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventsSince</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="lit">2015</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">),</span><span class="pln"> limit</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getEventsSince</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="lit">2015</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="com">// if (events.length === amount) {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events.next(function (err, nextEvts) {}); // just call next to retrieve the next page...</span><span class="pln"><br />&nbsp; </span><span class="com">// } else {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; // finished...</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>streaming your events</h2>

<p>Some databases support streaming your events, the api is similar to the query one</p>

<p>skip, limit always optional</p>

<pre><code><span class="kwd">var</span><span class="pln"> skip </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; limit </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln"> </span><span class="com">// if you omit limit or you define it as -1 it will retrieve until the end</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> stream </span><span class="pun">=</span><span class="pln"> es</span><span class="pun">.</span><span class="pln">streamEvents</span><span class="pun">(</span><span class="pln">skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">);</span><span class="pln"><br /></span><span class="com">// or</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> stream </span><span class="pun">=</span><span class="pln"> es</span><span class="pun">.</span><span class="pln">streamEvents</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">);</span><span class="pln"><br /></span><span class="com">// or by commitstamp</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> stream </span><span class="pun">=</span><span class="pln"> es</span><span class="pun">.</span><span class="pln">streamEventsSince</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="lit">2015</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">),</span><span class="pln"> skip</span><span class="pun">,</span><span class="pln"> limit</span><span class="pun">);</span><span class="pln"><br /></span><span class="com">// or by revision</span><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> stream </span><span class="pun">=</span><span class="pln"> es</span><span class="pun">.</span><span class="pln">streamEventsByRevision</span><span class="pun">({</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'myAggregateId'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pun">,</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br />stream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'data'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; doSomethingWithEvent</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br />stream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'end'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'no more evets'</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or even better</span><span class="pln"><br />stream</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">(</span><span class="pln">myWritableStream</span><span class="pun">);</span><span class="pln"><br /></span></code></pre>

<p>currently supported by:</p>

<ol>
<li>mongodb</li>
</ol>

<h2>get the last event</h2>

<p>for example to obtain the last revision nr</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getLastEvent</span><span class="pun">(</span><span class="str">'streamId'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="com">// or</span><span class="pln"><br /><br />es</span><span class="pun">.</span><span class="pln">getLastEvent</span><span class="pun">({</span><span class="pln"> </span><span class="com">// free choice (all, only context, only aggregate, only aggregateId...)</span><span class="pln"><br />&nbsp; context</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hr'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregate</span><span class="pun">:</span><span class="pln"> </span><span class="str">'person'</span><span class="pun">,</span><span class="pln"><br />&nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'uuid'</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> evt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>obtain a new id</h2>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">getNewId</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> newId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'ohhh :-('</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'the new id is: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> newId</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h2>position of event in store</h2>

<p>some db implementations support writing the position of the event in the whole store additional to the streamRevision.</p>

<p>currently those implementations support this:</p>

<p>*. inmemory ( by setting <code>trackPosition`` option )
  *. mongodb ( by setting</code>positionsCollectionName``` option)</p>

<h2>special scaling handling with mongodb</h2>

<p>Inserting multiple events (documents) in mongodb, is not atomic.
For the eventstore tries to repair itself when calling <code>getEventsByRevision</code>.
But if you want you can trigger this from outside:</p>

<pre><code><span class="pln">es</span><span class="pun">.</span><span class="pln">store</span><span class="pun">.</span><span class="pln">getPendingTransactions</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> txs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'ohhh :-('</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// txs is an array of objects like:</span><span class="pln"><br />&nbsp; </span><span class="com">// {</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; _id: '/* the commitId of the committed event stream */',</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; events: [ /* all events of the committed event stream */ ],</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; aggregateId: 'aggregateId',</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; aggregate: 'aggregate', // optional</span><span class="pln"><br />&nbsp; </span><span class="com">// &nbsp; context: 'context' &nbsp; &nbsp; &nbsp;// optional</span><span class="pln"><br />&nbsp; </span><span class="com">// }</span><span class="pln"><br /><br />&nbsp; es</span><span class="pun">.</span><span class="pln">store</span><span class="pun">.</span><span class="pln">getLastEvent</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; aggregateId</span><span class="pun">:</span><span class="pln"> txs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">aggregateId</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; aggregate</span><span class="pun">:</span><span class="pln"> txs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">aggregate</span><span class="pun">,</span><span class="pln"> </span><span class="com">// optional</span><span class="pln"><br />&nbsp; &nbsp; context</span><span class="pun">:</span><span class="pln"> txs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">context &nbsp; &nbsp; &nbsp;</span><span class="com">// optional</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> lastEvent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'ohhh :-('</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; es</span><span class="pun">.</span><span class="pln">store</span><span class="pun">.</span><span class="pln">repairFailedTransaction</span><span class="pun">(</span><span class="pln">lastEvent</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'ohhh :-('</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'everything is fine'</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span></code></pre>

<h1>Sample Integration</h1>

<ul>
<li><a href="https://github.com/jamuhl/nodeCQRS">nodeCQRS</a> A CQRS sample integrating eventstore</li>
</ul>

<h1>Inspiration</h1>

<ul>
<li>Jonathan Oliver's <a href="https://github.com/joliver/EventStore">EventStore</a> for .net.</li>
</ul>

<h1><a href="https://github.com/adrai/node-eventstore/blob/master/releasenotes.md">Release notes</a></h1>

<h1>Database Support</h1>

<p>Currently these databases are supported:</p>

<ol>
<li>inmemory</li>
<li>mongodb (<a href="https://github.com/mongodb/node-mongodb-native">node-mongodb-native</a>)</li>
<li>redis (<a href="https://github.com/mranney/node_redis">redis</a>)</li>
<li>tingodb (<a href="https://github.com/sergeyksv/tingodb">tingodb</a>)</li>
<li>azuretable (<a href="https://github.com/Azure/azure-storage-node">azure-storage</a>)</li>
<li>dynamodb (<a href="https://github.com/aws/aws-sdk-js">aws-sdk</a>)</li>
</ol>

<h2>own db implementation</h2>

<p>You can use your own db implementation by extending this...</p>

<pre><code><span class="kwd">var</span><span class="pln"> </span><span class="typ">Store</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">).</span><span class="typ">Store</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; util </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'util'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; _ </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'lodash'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="kwd">function</span><span class="pln"> </span><span class="typ">MyDB</span><span class="pun">(</span><span class="pln">options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; options </span><span class="pun">=</span><span class="pln"> options </span><span class="pun">||</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br />&nbsp; </span><span class="typ">Store</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br />util</span><span class="pun">.</span><span class="pln">inherits</span><span class="pun">(</span><span class="typ">MyDB</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Store</span><span class="pun">);</span><span class="pln"><br /><br />_</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="typ">MyDB</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /><br />&nbsp; </span><span class="com">// ...</span><span class="pln"><br /><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MyDB</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>

<p>and you can use it in this way</p>

<pre><code><span class="kwd">var</span><span class="pln"> es </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'eventstore'</span><span class="pun">)({</span><span class="pln"><br />&nbsp; type</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MyDB</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /></span><span class="com">// es.init...</span><span class="pln"><br /></span></code></pre>

<h1>License</h1>

<p>Copyright (c) 2018 Adriano Raiano, Jan Muehlemann</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>

</section>

<footer>
        <p>Copyright 2020</p>
</footer>


<script type="text/javascript" >
    $(window).load(function () {
        $('#title').fadeIn(1000, function(){
            $('#subtitle').fadeIn(2000);            
        });

        var nav = new FlexibleNavMaker('#content h1, #content h2, #content h3').make().prependTo('body');
        new FlexibleNav(nav);
        $(".flexible-nav").hide();
    });

    var fadeout = null;
    window.onscroll = function() {
        
        clearTimeout(fadeout);
                
        $(".flexible-nav").fadeIn('slow')
        
        fadeout = setTimeout(outlineFadeOut,4000);
    }
    
    var outlineFadeOut = function() {
        $(".flexible-nav").fadeOut()
    }

</script>

</body>

</html>